{#
purpose: Used for card and row displayed content callouts

- field_display_format (key) [row, card]
- field_icon_type (key) [none, download, link, play]
- field_cta_link_display (key) [text, button, icon]
- field_link_wrapper (boolean) [field--link-wrapper-on, field--link-wrapper-off]

- field_cta_image (media entity ref to an image or svg)
- field_heading (formatted text)
- field_cta_teaser (long formatted text)

- field_cta_ext_link (link)
- field_cta_file (media entity ref to a document)

#}

{% set displayFormat %}
  {{ content.field_display_format|render|lower|trim }}
{% endset %}

{% set imageType = 'cta-with-photo' %}
{% if attributes.hasClass('media-type-svg-image') %}
{% set imageType = 'cta-with-icon' %}
{% endif %}

{% if 'row' in displayFormat %}
{{ attach_library('demo_design_system_theme/individual-cta-row') }}
{% else %}
  {% if 'icon' in imageType %}
  {{ attach_library('demo_design_system_theme/cta-block-cards') }}
  {% else %}
  {{ attach_library('demo_design_system_theme/half-content-cards-with-buttons') }}
  {% endif %}
{% endif %}

{% set icon_type %}
  {{ content.field_icon_type|render|lower|trim }}
{% endset %}

{% if 'download' in icon_type %}
{% set icon_class = 'fa-download' %}
{% elseif 'link' in icon_type %}
{% set icon_class = 'fa-external-link-alt' %}
{% elseif 'play' in icon_type %}
{% set icon_class = 'fa-play' %}
{% else %}
{% set icon_class = 'none' %}
{% endif %}

{% set link_wrapper %}
  {{ content.field_link_wrapper|render|lower|trim }}
{% endset %}

{# extract media entity img properties #}
{% set imgUrl = file_url(content.field_cta_image[0]['#media'].field_media_image.entity.uri.value) %}
{% set alternativeText = content.field_cta_image[0]['#media'].field_media_image.alt %}

{# extract button/link properties #}
{% set buttonUrl = content.field_cta_ext_link.0['#url'] %}
{% set buttonAttributesAriaLabel = content.field_cta_ext_link.0['#url'].options.attributes['aria-label'] %}
{% if content.field_cta_file|render|trim|length > 0 %}
  {% set buttonUrl = file_url(content.field_cta_file[0]['#media'].field_media_document.entity.uri.value) %}
{% endif %}
{% set buttonTarget = content.field_cta_ext_link.0['#url'].external == true ? '_blank' : '_self' %}

{% if buttonUrl|render|trim ends with 'pdf' %}
  {% set analytics_class = 'analytics--d-link' %}
{% elseif 'http' in buttonUrl|render|trim %}
  {% set analytics_class = 'analytics--o-exit-open' %}
{% else %}
  {% set analytics_class = 'analytics--p-cta' %}
{% endif %}

{% set buttonText = content.field_cta_ext_link.0['#title'] %}

{% set settings_custom_id = paragraph.getBehaviorSetting('custom_paragraph_behaviors_paragraph_custom_id_classes', 'custom_id') %}
{% set settings_custom_classes = paragraph.getBehaviorSetting('custom_paragraph_behaviors_paragraph_custom_id_classes', 'custom_classes') %}
{% set settings_default_item_classes = paragraph.getParentEntity.getBehaviorSetting('custom_paragraph_behaviors_paragraph_componets_group_settings', 'default_item_classes') %}
{% set custom_id = settings_custom_id ? settings_custom_id : 'paragraph-' ~ paragraph.id() %}
{%
  set classes = [
  'call-to-action',
  'call-to-action' ~ displayFormat|clean_class,
  imageType,
  'row' in displayFormat ? 'cta-row ods-m-auto',
  'card' in displayFormat and 'icon' in imageType ? 'col-12 col-sm-6 col-md-6 col-lg-4 ods-mb-25 max-width-height',
  'card' in displayFormat and 'photo' in imageType ? 'ods-flex-justify-content-center',
  settings_custom_classes ? settings_custom_classes : settings_default_item_classes,
  content.field_link_wrapper|render|striptags|trim|lower,
]
%}
{% block paragraph %}
  <div{{ attributes.removeClass('media-type-svg-image').removeClass('media-type-image').addClass(classes).setAttribute('id', custom_id) }}>
  {% block content %}
  {% if 'row' in displayFormat %}
    <div class="card-body d-flex flex-wrap align-items-center">
      {% if content.field_cta_image %}
      <div class="img-container col-4 col-sm-2">
        <!-- At the moment img src is defined in the scss stylesheet  -->
        {{ content.field_cta_image }}
      </div>
      {% endif %}
      <div class="col-12 col-sm-6 ods-mt-15">
        {#<h4>#}<div class="card-title">{{- content.field_heading -}}</div>
        {#<p>#}<div class="card-text">{{- content.field_cta_teaser -}}</div>
      </div>
      {% if content.field_cta_ext_link|render|trim|length > 0 or content.field_cta_file|render|trim|length > 0 %}
      <div class="button-container col-12 col-sm-4">
        <a href="{{- buttonUrl -}}"
          class="cta-link {{ analytics_class }} text-uppercase float-lg-right float-md-right float-sm-right {% if 'button' in content.field_cta_link_display|render|lower|trim %}btn btn-primary btn-sm btn-rounded{% endif %} "
          data-analytics-id="{{ ('cta-btn-' ~ element['#object'].id.value)|data_analytics_id }}"
          target="{{- linkTarget -}}"
            {{ buttonAttributesAriaLabel ? ('aria-label="' ~ buttonAttributesAriaLabel ~ '"')|raw }}
        >{% spaceless %}
          {% if 'icon' not in content.field_cta_link_display|render|lower|trim %}
          {{- buttonText -}}
          {% endif %}
          {% if 'none' not in icon_class %}
          <i class="fa {{ icon_class }}" aria-hidden="true"></i>
          {% endif %}
        {% endspaceless %}</a>
      </div>
      {% endif %}
    </div>

  {% else %}

    {% if 'cta-with-icon' in imageType %}
      {# card with icon across top #}
      <div class="card common-border height-100 px-2">
        <div class="card-body d-flex flex-wrap justify-content-center text-center height-100">
          {% if content.field_cta_image %}
            <div class="ods-mt-25 col-12">
              {{ content.field_cta_image }}
            </div>
          {% endif %}
          {#<h4>#}<div class="card-title ods-mt-15">{{- content.field_heading -}}</div>
          {#<p>#}<div class="card-text">{{- content.field_cta_teaser -}}</div>
          {% if content.field_cta_ext_link|render|trim|length > 0 or content.field_cta_file|render|trim|length > 0 %}
            <a role="button" tabindex="0" href="{{- buttonUrl -}}"
                class="cta-link {{ analytics_class }} text-uppercase mt-auto ods-mb-25 {% if 'button' in content.field_cta_link_display|render|lower|trim %}btn btn-primary btn-sm btn-rounded{% endif %}"
                data-analytics-id="{{ ('cta-btn-' ~ element['#object'].id.value)|data_analytics_id }}"
                target="{{- linkTarget -}}"
                {{ buttonAttributesAriaLabel ? ('aria-label="' ~ buttonAttributesAriaLabel ~ '"')|raw }}
            >{% spaceless %}
              {% if 'icon' not in content.field_cta_link_display|render|lower|trim %}
              {{- buttonText -}}
              {% endif %}
              {% if 'none' not in icon_class %}
              <i class="fa {{ icon_class }}" aria-hidden="true"></i>
              {% endif %}
            {% endspaceless %}</a>
          {% endif %}
        </div>
      </div>

    {% else %}

      {# card with photo across top #}
      <div class="card max-width-height common-border ods-mb-25">
      {% if content.field_cta_image %}
        {{ content.field_cta_image }}
      {% endif %}
      <div class="col-12 max-width-height">
      <div class="card-body">
      {#<h4>#}
      <div class="card-title ods-mt-15">{{- content.field_heading -}}</div>
      {#<p>#}
      <div class="card-text">{{- content.field_cta_teaser -}}</div>
      </div>{#/.card-body#}
      </div>{#/.col-12#}
      {% if content.field_cta_ext_link|render|trim|length > 0 or content.field_cta_file|render|trim|length > 0 %}
        <div class="anchor-button-container">
        <a role="button" tabindex="0" href="{{- buttonUrl -}}"
           class="cta-link {{ analytics_class }} text-uppercase mt-auto ods-mb-15 {% if 'button' in content.field_cta_link_display|render|lower|trim %}btn btn-primary btn-sm btn-rounded{% endif %}"
           data-analytics-id="{{ ('cta-btn-' ~ element['#object'].id.value)|data_analytics_id }}"
           target="{{- linkTarget -}}"
            {{ buttonAttributesAriaLabel ? ('aria-label="' ~ buttonAttributesAriaLabel ~ '"')|raw }}
        >{% spaceless %}
            {% if 'icon' not in content.field_cta_link_display|render|lower|trim %}
              {{- buttonText -}}
            {% endif %}
            {% if 'none' not in icon_class %}
              <i class="fa {{ icon_class }}" aria-hidden="true"></i>
            {% endif %}
          {% endspaceless %}</a>
        </div>{#/.anchor-button-container#}
      {% endif %}
      </div>{#/.card#}

    {% endif %}

  {% endif %}
  {% endblock %}
  </div>
{% endblock paragraph %}
